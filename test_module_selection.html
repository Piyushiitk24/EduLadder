<!DOCTYPE html>
<html>
<head>
    <title>Module Selection Test</title>
    <style>
        .module-card { border: 1px solid #ccc; padding: 10px; margin: 5px; cursor: pointer; }
        .module-card.selected { background: lightblue; }
        .startBtn:disabled { opacity: 0.5; cursor: not-allowed; }
    </style>
</head>
<body>
    <h1>Module Selection Test</h1>
    
    <div class="module-card" data-module="tlprocess" onclick="selectModule('tlprocess')">
        <h3>Teaching Learning Process</h3>
    </div>
    
    <button class="startBtn" id="moduleNextBtn" disabled>NEXT</button>
    
    <div id="debug"></div>

    <script>
        let allQuestionsData = null;
        let moduleQuestions = { easy: [], hard: [] };
        let selectedModule = null;

        // Load questions from JSON file
        async function loadQuestions() {
            try {
                const response = await fetch('./questions/questions.json');
                allQuestionsData = await response.json();
                console.log('Questions loaded successfully:', allQuestionsData);
                document.getElementById('debug').innerHTML += 'Questions loaded: ' + Object.keys(allQuestionsData).join(', ') + '<br>';
            } catch (error) {
                console.error('Error loading questions:', error);
                document.getElementById('debug').innerHTML += 'Error loading questions: ' + error.message + '<br>';
            }
        }

        // Set questions for the selected module
        function setModuleQuestions(moduleId) {
            if (!allQuestionsData || !allQuestionsData[moduleId]) {
                console.error(`Module ${moduleId} not found in questions data`);
                return false;
            }
            
            const moduleData = allQuestionsData[moduleId];
            
            if (Array.isArray(moduleData)) {
                const easyQuestions = moduleData.filter(q => q.difficulty === 'easy');
                const hardQuestions = moduleData.filter(q => q.difficulty === 'hard');
                
                moduleQuestions.easy = easyQuestions.map(q => ({
                    text: q.question,
                    options: q.options,
                    correctIndex: q.correct
                }));
                
                moduleQuestions.hard = hardQuestions.map(q => ({
                    text: q.question,
                    options: q.options,
                    correctIndex: q.correct
                }));
                
                console.log(`Loaded ${moduleQuestions.easy.length} easy and ${moduleQuestions.hard.length} hard questions`);
                document.getElementById('debug').innerHTML += `Loaded ${moduleQuestions.easy.length} easy and ${moduleQuestions.hard.length} hard questions<br>`;
                return true;
            }
            return false;
        }

        // Function to select a module
        function selectModule(moduleId) {
            console.log(`Selecting module: ${moduleId}`);
            document.getElementById('debug').innerHTML += `Selecting module: ${moduleId}<br>`;
            
            // Remove selection from all cards
            const allCards = document.querySelectorAll('.module-card');
            allCards.forEach(card => card.classList.remove('selected'));
            
            // Add selection to clicked card
            const selectedCard = document.querySelector(`[data-module="${moduleId}"]`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
                selectedModule = moduleId;
                
                // Load questions for the selected module
                const success = setModuleQuestions(moduleId);
                if (success) {
                    // Enable the next button
                    const nextBtn = document.getElementById('moduleNextBtn');
                    if (nextBtn) {
                        nextBtn.disabled = false;
                        nextBtn.style.opacity = '1';
                        document.getElementById('debug').innerHTML += 'Next button enabled!<br>';
                    }
                }
            }
        }

        // Load questions on page load
        document.addEventListener('DOMContentLoaded', loadQuestions);
    </script>
</body>
</html>
